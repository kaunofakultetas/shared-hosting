openapi: 3.0.3
info:
  title: App Hosting Platform API Documentation
  description: |
    API for managing app hosting platform.
    This API allows frontend to manage app hosting platform, including user authentication,
    virtual server management, and DNS configuration.
  version: 1.0.0
  contact:
    name: VU KnF

servers:
  - url: https://hosting.knf.vu.lt
    description: Production server
  - url: https://hostingdev.knf.vu.lt
    description: Development server



tags:
  - name: Authentication
    description: User authentication and authorization endpoints
  - name: Account
    description: User account management endpoints
  - name: Users
    description: User management endpoints (Admin only)
  - name: Virtual Servers
    description: Virtual server management and control endpoints
  - name: DNS
    description: Domain name and DNS management endpoints
  - name: Dashboard
    description: Admin dashboard and system monitoring endpoints
  - name: SSH Router
    description: Internal SSH routing endpoints (requires API key)




paths:
  # ============================================
  # AUTHENTICATION
  # ============================================
  /api/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user with email and password. Returns a session cookie on success.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  description: User's email address
                  example: user@example.com
                password:
                  type: string
                  format: password
                  description: User's password
                  example: password123
      responses:
        '200':
          description: Login successful
          headers:
            Set-Cookie:
              description: Session cookie for authentication
              schema:
                type: string
          content:
            text/plain:
              schema:
                type: string
                example: OK
        '400':
          description: Invalid credentials or missing fields
          content:
            text/plain:
              schema:
                type: string
              examples:
                missing_both:
                  value: Įveskite El. Pašto adresą ir Slaptažodį.
                  summary: Both email and password missing
                missing_email:
                  value: Įveskite El. Pašto adresą.
                  summary: Email missing
                missing_password:
                  value: Įveskite Slaptažodį.
                  summary: Password missing
                invalid_credentials:
                  value: El. Paštas ir/arba Slaptažodis neteisingas.
                  summary: Invalid email or password

  /api/register:
    post:
      tags:
        - Authentication
      summary: Register new user
      description: |
        Create a new user account using a valid registration code.
        Registration codes are generated by admins and expire after 30 minutes.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistration'
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Registration successful! You can now login.
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_code:
                  value:
                    message: Registration code is required
                missing_email:
                  value:
                    message: Email is required
                missing_password:
                  value:
                    message: Password is required
                short_password:
                  value:
                    message: Password must be at least 6 characters
                invalid_email:
                  value:
                    message: Invalid email format
                invalid_code:
                  value:
                    message: Invalid registration code
                email_exists:
                  value:
                    message: Email already exists

  /api/checkauth:
    get:
      tags:
        - Authentication
      summary: Check authentication status
      description: Verify if user is authenticated and return user information. Also updates the user's last login timestamp.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: User is authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserInfo'
        '401':
          description: Unauthorized - User is not authenticated or disabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/checkauth/vm/{virtualServerID}:
    get:
      tags:
        - Authentication
      summary: Check authentication for specific virtual server
      description: Verify if user is authenticated and authorized to access a specific virtual server. User must be the owner or an admin.
      security:
        - cookieAuth: []
      parameters:
        - name: virtualServerID
          in: path
          required: true
          schema:
            type: integer
          description: Virtual server ID to check access for
          example: 1
      responses:
        '200':
          description: User is authenticated and authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserInfo'
        '401':
          description: Unauthorized - User not authenticated or not allowed to access this virtual server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/checkauth/admin:
    get:
      tags:
        - Authentication
      summary: Check admin authentication
      description: Verify if user is authenticated as admin. Updates last login timestamp.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: User is authenticated as admin
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserInfo'
        '401':
          description: Unauthorized - User is not admin
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'


  # ============================================
  # ACCOUNT MANAGEMENT
  # ============================================
  /api/account/change-password:
    post:
      tags:
        - Account
      summary: Change user password
      description: Allow authenticated users to change their own password. Current password verification is required.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                  format: password
                  description: User's current password
                  example: oldPassword123
                newPassword:
                  type: string
                  format: password
                  minLength: 8
                  description: New password (minimum 8 characters)
                  example: newSecurePassword456
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password changed successfully
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_current:
                  value:
                    message: Current password is required
                missing_new:
                  value:
                    message: New password is required
                short_password:
                  value:
                    message: New password must be at least 8 characters
        '401':
          description: Current password is incorrect
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/account/registration-code:
    get:
      tags:
        - Account
      summary: Get current registration code (Admin only)
      description: |
        Retrieve the current admin's registration code if one exists and is not expired.
        Expired codes are automatically deleted when this endpoint is called.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Registration code found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegistrationCodeResponse'
        '401':
          description: Unauthorized - Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: No registration code found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No registration code found

    post:
      tags:
        - Account
      summary: Create new registration code (Admin only)
      description: |
        Generate a new registration code for user registration.
        The code is valid for 30 minutes and replaces any existing code for this admin.
        Code format: 8 uppercase alphanumeric characters.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Registration code created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegistrationCodeResponse'
        '401':
          description: Unauthorized - Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Account
      summary: Delete registration code (Admin only)
      description: Remove the current admin's registration code, invalidating it immediately.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Registration code deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Registration code deleted successfully
        '401':
          description: Unauthorized - Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'


  # ============================================
  # USERS MANAGEMENT (ADMIN)
  # ============================================
  /api/admin/users:
    get:
      tags:
        - Users
      summary: Get all users (Admin only)
      description: Retrieve list of all users with their virtual server counts and account status.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserListItem'
        '401':
          description: Unauthorized - Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    
    post:
      tags:
        - Users
      summary: Create, update, or delete user (Admin only)
      description: |
        Manage user accounts. Supported actions:
        - **insertupdate**: Create new user (if id is empty) or update existing user
        - **delete**: Delete a user (fails if user has virtual servers)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/UserCreateUpdate'
                - $ref: '#/components/schemas/UserDelete'
            examples:
              create_user:
                summary: Create new user
                value:
                  action: insertupdate
                  id: ""
                  email: newuser@example.com
                  password: securePassword123
                  admin: 0
                  enabled: 1
              update_user:
                summary: Update existing user
                value:
                  action: insertupdate
                  id: "5"
                  email: updated@example.com
                  password: ""
                  admin: 0
                  enabled: 1
              delete_user:
                summary: Delete user
                value:
                  action: delete
                  id: "5"
      responses:
        '200':
          description: Operation successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  type:
                    type: string
                    enum: [ok, error]
                    example: ok
                  reason:
                    type: string
                    description: Error reason (only present when type is error)
              examples:
                success:
                  value:
                    type: ok
                password_error:
                  value:
                    type: error
                    reason: Password must be at least 8 characters long
                has_servers:
                  value:
                    type: error
                    reason: User has virtual servers
        '401':
          description: Unauthorized - Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'


  # ============================================
  # VIRTUAL SERVERS
  # ============================================
  /api/vm:
    get:
      tags:
        - Virtual Servers
      summary: Get virtual servers
      description: |
        Retrieve list of virtual servers.
        - Regular users see only their own servers
        - Admins can optionally see all servers using the showOtherUsers parameter
      security:
        - cookieAuth: []
      parameters:
        - name: showOtherUsers
          in: query
          schema:
            type: boolean
            default: false
          description: Show virtual servers from all users (Admin only)
      responses:
        '200':
          description: List of virtual servers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VirtualServer'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/vm/{virtualServerID}:
    get:
      tags:
        - Virtual Servers
      summary: Get specific virtual server
      description: Retrieve details of a specific virtual server. User must be the owner or an admin.
      security:
        - cookieAuth: []
      parameters:
        - name: virtualServerID
          in: path
          required: true
          schema:
            type: integer
          description: Virtual server ID
          example: 1
      responses:
        '200':
          description: Virtual server details
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VirtualServer'
        '401':
          description: Unauthorized - Not allowed to access this virtual server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/vm/control:
    post:
      tags:
        - Virtual Servers
      summary: Control virtual server
      description: |
        Perform actions on virtual servers:
        - **create**: Create a new virtual server
        - **start**: Start a stopped virtual server
        - **stop**: Stop a running virtual server
        - **delete**: Delete a virtual server
        - **rename**: Rename a virtual server
        
        For all actions except create, the user must be the owner or an admin.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/VirtualServerCreate'
                - $ref: '#/components/schemas/VirtualServerControl'
                - $ref: '#/components/schemas/VirtualServerRename'
            examples:
              create:
                summary: Create new virtual server
                value:
                  action: create
                  name: My New Server
              start:
                summary: Start virtual server
                value:
                  action: start
                  virtualServerID: "1"
              stop:
                summary: Stop virtual server
                value:
                  action: stop
                  virtualServerID: "1"
              delete:
                summary: Delete virtual server
                value:
                  action: delete
                  virtualServerID: "1"
              rename:
                summary: Rename virtual server
                value:
                  action: rename
                  virtualServerID: "1"
                  newName: My Renamed Server
      responses:
        '200':
          description: Action completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OK
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_name:
                  value:
                    message: Name is required
                short_name:
                  value:
                    message: New name must be at least 3 characters long
                long_name:
                  value:
                    message: Name must be less than 30 characters long
                invalid_chars:
                  value:
                    message: Name can only contain letters, numbers, spaces, and hyphens
                invalid_action:
                  value:
                    message: Invalid action
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                create_failed:
                  value:
                    message: Failed to create virtual server
                start_failed:
                  value:
                    message: Failed to start virtual server
                stop_failed:
                  value:
                    message: Failed to stop virtual server
                delete_failed:
                  value:
                    message: Failed to delete virtual server


  # ============================================
  # DNS MANAGEMENT
  # ============================================
  /api/vm/dns/isvalid:
    get:
      tags:
        - DNS
      summary: Validate domain name
      description: |
        Check if a domain name is valid and available for use.
        
        Validation rules:
        - Minimum 5 characters
        - Maximum 39 characters
        - Must contain at least one dot
        - No repeated dots (..)
        - Only alphanumeric characters, hyphens, underscores, and dots allowed
        - Must start and end with a letter (a-z)
        - Must not be already taken by another virtual server
      security:
        - cookieAuth: []
      parameters:
        - name: domainname
          in: query
          required: true
          schema:
            type: string
          description: Domain name to validate (URL encoded)
          example: myapp.example.com
        - name: virtualserverid
          in: query
          required: true
          schema:
            type: integer
          description: Virtual server ID (used to exclude current domains from duplicate check)
          example: 1
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  isvalid:
                    type: boolean
                    description: Whether the domain name is valid
                    example: true
                  error_message:
                    type: string
                    description: Validation result message
                    example: Domain name is valid

  /api/vm/dns/{virtualServerID}:
    get:
      tags:
        - DNS
      summary: Get domain names for virtual server
      description: Retrieve all domain names configured for a specific virtual server.
      security:
        - cookieAuth: []
      parameters:
        - name: virtualServerID
          in: path
          required: true
          schema:
            type: integer
          description: Virtual server ID
          example: 1
      responses:
        '200':
          description: List of domain names
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DomainName'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - DNS
      summary: Add new domain name
      description: |
        Create a new domain name for a virtual server.
        The domain name will be validated before creation.
        After successful creation, the Caddy reverse proxy configuration is automatically updated.
      security:
        - cookieAuth: []
      parameters:
        - name: virtualServerID
          in: path
          required: true
          schema:
            type: integer
          description: Virtual server ID
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DomainNameCreate'
      responses:
        '200':
          description: Domain name created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: ok
        '400':
          description: Invalid domain name
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error
                  reason:
                    type: string
                    description: Validation error reason
                    example: Domain name is already taken
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - DNS
      summary: Update domain name
      description: |
        Update an existing domain name configuration.
        The domain name will be re-validated before update.
        After successful update, the Caddy reverse proxy configuration is automatically updated.
      security:
        - cookieAuth: []
      parameters:
        - name: virtualServerID
          in: path
          required: true
          schema:
            type: integer
          description: Virtual server ID
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DomainNameUpdate'
      responses:
        '200':
          description: Domain name updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: ok
        '400':
          description: Invalid domain name
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Error
                  reason:
                    type: string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/vm/dns/{virtualServerID}/{domainID}:
    delete:
      tags:
        - DNS
      summary: Delete domain name
      description: |
        Remove a domain name from a virtual server.
        After successful deletion, the Caddy reverse proxy configuration is automatically updated.
      security:
        - cookieAuth: []
      parameters:
        - name: virtualServerID
          in: path
          required: true
          schema:
            type: integer
          description: Virtual server ID
          example: 1
        - name: domainID
          in: path
          required: true
          schema:
            type: integer
          description: Domain ID to delete
          example: 5
      responses:
        '200':
          description: Domain name deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: ok
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'


  # ============================================
  # DASHBOARD (ADMIN)
  # ============================================
  /api/dashboard/system:
    get:
      tags:
        - Dashboard
      summary: Get system resource usage (Admin only)
      description: |
        Retrieve current system resource usage including CPU, memory, and disk statistics.
        Data is fetched from cAdvisor. Also includes DockerHub pull rate limits.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: System resource usage
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemStats'
        '401':
          description: Unauthorized - Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Failed to fetch cAdvisor data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '503':
          description: No stats data available yet
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No stats data available yet
                  cpu_percent:
                    type: number
                    example: 0
                  memory_percent:
                    type: number
                    example: 0
                  disk_percent:
                    type: number
                    example: 0
        '504':
          description: cAdvisor request timeout
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/dashboard/recentactivity:
    get:
      tags:
        - Dashboard
      summary: Get recent activity log (Admin only)
      description: Retrieve the 5 most recent activity log entries from all users.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Recent activity log
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ActivityLogEntry'
        '401':
          description: Unauthorized - Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Failed to get recent activity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/dashboard/hostingsystem:
    get:
      tags:
        - Dashboard
      summary: Get hosting system statistics (Admin only)
      description: Retrieve summary statistics about the hosting system including user count, virtual servers, and domains.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Hosting system statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HostingSystemStats'
        '401':
          description: Unauthorized - Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Failed to get hosting system information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'


  # ============================================
  # SSH ROUTER (INTERNAL)
  # ============================================
  /api/sshrouter:
    post:
      tags:
        - SSH Router
      summary: Get SSH upstream configuration (Internal)
      description: |
        Internal endpoint used by the SSH proxy to get upstream server details for user connections.
        Requires API key authentication instead of session cookie.
        
        **Note**: This is an internal endpoint not intended for direct frontend use.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - api_key
              properties:
                username:
                  type: string
                  pattern: '^server[0-9]+$'
                  description: Username in format "server{ID}" where ID is the virtual server ID
                  example: server1
                api_key:
                  type: string
                  description: Backend SSH API key for authentication
                  example: your-api-key-here
      responses:
        '200':
          description: SSH upstream configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SSHUpstreamConfig'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_username:
                  value:
                    message: Username is required
                invalid_username:
                  value:
                    message: Username must start with "server"
                missing_api_key:
                  value:
                    message: API key is required
                invalid_server_id:
                  value:
                    message: Server ID must be a number
        '401':
          description: Invalid API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'




# ============================================
# COMPONENTS
# ============================================
components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: session
      description: Session cookie set after successful login

  schemas:
    # --------------------------------------------
    # Common Schemas
    # --------------------------------------------
    Error:
      type: object
      properties:
        message:
          type: string
          description: Error message
          example: Unauthorized

    # --------------------------------------------
    # User/Auth Schemas
    # --------------------------------------------
    UserInfo:
      type: object
      properties:
        id:
          type: integer
          description: User ID
          example: 1
        email:
          type: string
          format: email
          description: User's email address
          example: user@example.com
        admin:
          type: integer
          enum: [0, 1]
          description: Admin status (0 = regular user, 1 = admin)
          example: 0

    UserListItem:
      type: object
      properties:
        id:
          type: integer
          description: User ID
          example: 1
        email:
          type: string
          format: email
          description: User's email address
          example: user@example.com
        servercount:
          type: integer
          description: Number of virtual servers owned by user
          example: 3
        admin:
          type: integer
          enum: [0, 1]
          description: Admin status (0 = regular user, 1 = admin)
          example: 0
        enabled:
          type: integer
          enum: [0, 1]
          description: Account enabled status (0 = disabled, 1 = enabled)
          example: 1
        lastseen:
          type: string
          description: Last login timestamp
          example: "2025-11-14 10:30:00"

    UserCreateUpdate:
      type: object
      required:
        - action
        - email
        - admin
        - enabled
      properties:
        action:
          type: string
          enum: [insertupdate]
          description: Action type
        id:
          type: string
          description: User ID (empty string for new user)
          example: ""
        email:
          type: string
          format: email
          description: User's email address
          example: user@example.com
        password:
          type: string
          format: password
          description: Password (required for new users, optional for updates)
          example: securePassword123
        admin:
          type: integer
          enum: [0, 1]
          description: Admin status
          example: 0
        enabled:
          type: integer
          enum: [0, 1]
          description: Account enabled status
          example: 1

    UserDelete:
      type: object
      required:
        - action
        - id
      properties:
        action:
          type: string
          enum: [delete]
          description: Action type
        id:
          type: string
          description: User ID to delete
          example: "5"

    UserRegistration:
      type: object
      required:
        - registrationCode
        - email
        - password
      properties:
        registrationCode:
          type: string
          pattern: '^[A-Z0-9]{8}$'
          description: 8-character registration code from admin
          example: ABC12345
        email:
          type: string
          format: email
          description: Email address for new account
          example: newuser@example.com
        password:
          type: string
          format: password
          minLength: 6
          description: Password (minimum 6 characters)
          example: mySecurePassword

    RegistrationCodeResponse:
      type: object
      properties:
        message:
          type: string
          example: Registration code found
        code:
          type: string
          pattern: '^[A-Z0-9]{8}$'
          description: 8-character alphanumeric registration code
          example: ABC12345
        validUntil:
          type: integer
          description: Unix timestamp when the code expires
          example: 1699999999

    # --------------------------------------------
    # Virtual Server Schemas
    # --------------------------------------------
    VirtualServer:
      type: object
      properties:
        id:
          type: string
          description: Virtual server ID
          example: "1"
        name:
          type: string
          description: Virtual server name
          example: My Application
        status:
          type: string
          description: Container status description
          example: Up 2 hours
        state:
          type: string
          enum: [running, exited, paused, created]
          description: Container state
          example: running
        enabled:
          type: integer
          enum: [0, 1]
          description: Whether the server is enabled
          example: 1
        owneremail:
          type: string
          format: email
          description: Owner's email address
          example: user@example.com
        stacks:
          type: array
          nullable: true
          description: Docker compose stacks running in this virtual server
          items:
            $ref: '#/components/schemas/Stack'
        domains:
          type: array
          nullable: true
          description: Domain names configured for this virtual server
          items:
            $ref: '#/components/schemas/DomainNameShort'

    Stack:
      type: object
      properties:
        stackname:
          type: string
          description: Docker compose project name
          example: myapp
        containers:
          type: array
          items:
            $ref: '#/components/schemas/Container'

    Container:
      type: object
      properties:
        image:
          type: string
          description: Docker image name
          example: nginx:latest
        names:
          type: string
          description: Container name
          example: myapp-web-1
        runningfor:
          type: string
          description: How long the container has been running
          example: 2 hours ago
        state:
          type: string
          enum: [running, exited, paused, created]
          description: Container state
          example: running
        status:
          type: string
          description: Container status description
          example: Up 2 hours

    VirtualServerCreate:
      type: object
      required:
        - action
        - name
      properties:
        action:
          type: string
          enum: [create]
          description: Action type
        name:
          type: string
          minLength: 3
          maxLength: 30
          description: Name for the new virtual server (letters, numbers, spaces, hyphens)
          example: My New Server

    VirtualServerControl:
      type: object
      required:
        - action
        - virtualServerID
      properties:
        action:
          type: string
          enum: [start, stop, delete]
          description: Action to perform
        virtualServerID:
          type: string
          description: Virtual server ID
          example: "1"

    VirtualServerRename:
      type: object
      required:
        - action
        - virtualServerID
        - newName
      properties:
        action:
          type: string
          enum: [rename]
          description: Action type
        virtualServerID:
          type: string
          description: Virtual server ID
          example: "1"
        newName:
          type: string
          minLength: 3
          maxLength: 30
          description: New name for the virtual server
          example: My Renamed Server

    # --------------------------------------------
    # Domain Name Schemas
    # --------------------------------------------
    DomainName:
      type: object
      properties:
        id:
          type: integer
          description: Domain ID
          example: 1
        virtualserverid:
          type: integer
          description: Associated virtual server ID
          example: 1
        domainname:
          type: string
          description: Domain name
          example: myapp.example.com
        iscloudflare:
          type: integer
          enum: [0, 1]
          description: Whether the domain is behind Cloudflare proxy
          example: 0
        ssl:
          type: integer
          enum: [0, 1]
          description: Whether SSL is enabled for this domain
          example: 1

    DomainNameShort:
      type: object
      properties:
        id:
          type: integer
          description: Domain ID
          example: 1
        domainname:
          type: string
          description: Domain name
          example: myapp.example.com
        iscloudflare:
          type: integer
          enum: [0, 1]
          description: Whether the domain is behind Cloudflare proxy
          example: 0
        ssl:
          type: integer
          enum: [0, 1]
          description: Whether SSL is enabled
          example: 1

    DomainNameCreate:
      type: object
      required:
        - domainname
        - iscloudflare
        - ssl
      properties:
        domainname:
          type: string
          minLength: 5
          maxLength: 39
          description: Domain name to add
          example: myapp.example.com
        iscloudflare:
          type: integer
          enum: [0, 1]
          description: Whether the domain is behind Cloudflare proxy
          example: 0
        ssl:
          type: integer
          enum: [0, 1]
          description: Whether to enable SSL for this domain
          example: 1

    DomainNameUpdate:
      type: object
      required:
        - domainid
        - domainname
        - iscloudflare
        - ssl
      properties:
        domainid:
          type: integer
          description: Domain ID to update
          example: 1
        domainname:
          type: string
          minLength: 5
          maxLength: 39
          description: Updated domain name
          example: myapp.example.com
        iscloudflare:
          type: integer
          enum: [0, 1]
          description: Whether the domain is behind Cloudflare proxy
          example: 0
        ssl:
          type: integer
          enum: [0, 1]
          description: Whether to enable SSL
          example: 1

    # --------------------------------------------
    # Dashboard Schemas
    # --------------------------------------------
    SystemStats:
      type: object
      properties:
        cpu_percent:
          type: number
          format: float
          description: CPU usage percentage
          example: 25.5
        memory_percent:
          type: number
          format: float
          description: Memory usage percentage
          example: 60.2
        disk_percent:
          type: number
          format: float
          description: Disk usage percentage
          example: 45.8
        cpu_cores:
          type: integer
          description: Number of CPU cores
          example: 4
        memory_total_gb:
          type: number
          format: float
          description: Total memory in GB
          example: 16.0
        memory_used_gb:
          type: number
          format: float
          description: Used memory in GB
          example: 9.6
        disk_total_gb:
          type: number
          format: float
          description: Total disk space in GB
          example: 500.0
        disk_used_gb:
          type: number
          format: float
          description: Used disk space in GB
          example: 229.0
        dockerhub_pull_limits:
          type: object
          nullable: true
          description: DockerHub rate limit information
          properties:
            limit:
              type: integer
              description: Maximum pulls allowed
              example: 200
            remaining:
              type: integer
              description: Remaining pulls
              example: 150
            used:
              type: integer
              description: Pulls used
              example: 50
            percent:
              type: number
              format: float
              description: Percentage of limit used
              example: 25.0

    ActivityLogEntry:
      type: object
      properties:
        log_id:
          type: integer
          description: Log entry ID
          example: 123
        email:
          type: string
          description: User email (or "Deleted User" if user was deleted)
          example: user@example.com
        message:
          type: string
          description: Activity description
          example: Virtual server #1 started
        time:
          type: string
          description: Timestamp of the activity
          example: "2025-11-14 10:30:00"

    HostingSystemStats:
      type: object
      properties:
        users:
          type: integer
          description: Total number of registered users
          example: 15
        virtualservers_running:
          type: integer
          description: Number of running virtual servers
          example: 8
        virtualservers_total:
          type: integer
          description: Total number of virtual servers (excluding deleted)
          example: 12
        domains:
          type: integer
          description: Total number of configured domain names
          example: 25

    # --------------------------------------------
    # SSH Router Schemas
    # --------------------------------------------
    SSHUpstreamConfig:
      type: object
      properties:
        password_hash:
          type: string
          description: Bcrypt password hash of the server owner
          example: $2b$12$...
        upstream_host:
          type: string
          description: Internal hostname of the virtual server container
          example: hosting-users-dind-1
        upstream_port:
          type: string
          description: SSH port on the upstream server
          example: "22"
        upstream_user:
          type: string
          description: SSH username for upstream connection
          example: root
        upstream_pass:
          type: string
          description: SSH password for upstream connection
          example: root
